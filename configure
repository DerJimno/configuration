#!/usr/bin/env bash

# Add uinput and logged user to groups
sudo groupadd -r uinput
sudo usermod -aG audio,video,optical,storage,input,uinput $USER

# Create udev rule for uinput
echo 'KERNEL=="uinput", MODE="0660", GROUP="uinput", OPTIONS+="static_node=uinput"' | \
sudo tee /etc/udev/rules.d/99-input.rules

# Configure Kanata Service
sudo tee /etc/systemd/system/kanata.service <<EOF
[Unit]
Description=Kanata Service
Requires=local-fs.target
After=local-fs.target

[Service]
ExecStartPre=/usr/bin/modprobe uinput
ExecStart=/usr/bin/kanata -c /home/menaouer/.config/kanata/kanata.kbd
Restart=no

[Install]
WantedBy=sysinit.target
EOF

# Configure Kanata
systemctl --user daemon-reload
systemctl --user enable kanata.service
systemctl --user start kanata.service
systemctl --user status kanata.service

# Configure notifications - dunst daemon
echo "[D-BUS Service]
Name=org.freedesktop.Notifications
Exec=/usr/bin/dunst" | \
sudo tee /usr/share/dbus-1/services/org.freedesktop.Notifications.service

# Configure custom dns - open-dns
echo -e "[main]\ndns=none" | sudo tee /etc/NetworkManager/conf.d/dns.conf
echo -e "# Generated by NetworkManager\nnameserver \
208.67.222.123 208.67.220.123" | sudo tee /etc/resolv.conf

# Configure Login-manager (ly)
systemctl enable ly.service

# Set default grub theme
sed -i "s/^#GRUB_THEME=.*/GRUB_THEME=\"\/boot\/grub\/themes\/einfach-base\/theme.txt\"/" /etc/default/grub 
grub-mkconfig -o /boot/grub/grub.cfg

# Completions for fnm
# fnm completions --shell=fish > ~/.config/fish/completions/fnm.fish



